<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8">

	<title>Bespin Plugin Guide</title>

	<link rel="stylesheet" type="text/css" href="../css/reset.css">
	<link rel="stylesheet" type="text/css" href="../css/stylesheet.css" media="screen,projection">
	<link rel="stylesheet" type="text/css" href="../css/colorful.css">
</head>
<body>

<!-- MAIN CONTAINER -->
<div id="main-container">

<!-- MENU -->
<ul id="menu">
	<li><a href="../index.html" title="Home">Home</a></li>
	<li class="current"><a href="../pluginguide/index.html" title="Plugin Guide">Creating Plugins</a></li>
	<li><a href="../embedding/index.html" title="Embedding Bespin in your app">Embedding</a></li>
	<li><a href="../devguide/index.html" title="Developer's Guide">Developing Bespin</a></li>
</ul>
<!-- / MENU -->

<h1 id="web-title">Bespin Plugin Guide</h1>
<h2 id="web-subtitle">Introduction</h2>

<!-- INDEX PAGE -->

<!-- MAIN COLUMN -->
<div id="maincol">
<p>Bespin is built around a small core with most additional functionality placed in plugins. The driving goals behind plugins are:</p>
<ul>
<li>Allow lazy loading of functionality</li>
<li>Be very easy to use</li>
<li>Make it possible to update the editor without page reloads</li>
</ul>
<p>The ability to load functionality lazily is very important, because we expect that Bespin will have a large number of features, only some of which any given person is likely to use at one time. The simplest example of this is syntax highlighters: maybe you write JavaScript most of the time, but someone else is developing Ruby code. If you only use JavaScript, that's the only syntax highlighter that will get loaded into your browser. And there are many more examples possible.</p>
<h2>The Basics</h2>
<p>A plugin consists of <em>metadata</em> and <em>everything else</em>. When you log into Bespin, the metadata for all of your plugins is loaded. Everything else (JavaScript, CSS, images, etc.) is loaded as needed. At its simplest, a plugin is a single .js file that contains a special section for the metadata. Here's a trivial example:</p>
<div class="codehilite"><pre><span class="o">//</span> <span class="o">---</span><span class="n">plugin</span><span class="p">.</span><span class="n">json</span><span class="o">---</span>
<span class="n">var</span> <span class="n">metadata</span> <span class="p">=</span> <span class="p">{};</span>
<span class="o">//</span> <span class="o">---</span>

<span class="n">exports</span><span class="p">.</span><span class="n">someFunction</span> <span class="p">=</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span> <span class="p">};</span>
</pre></div>


<p>Clearly, this example doesn't do anything useful. The first step in making a plugin do something is to define the appropriate metadata.</p>
<p>Bespin plugins feature <em>extensions</em> that plug into <em>extension points</em>. As an example of this, the simple syntax highlighter defines an extension point called "syntax.simple.highlighter". The JavaScript highlighter is one extension that plugs into that extension point. The metadata for the JavaScript highlighter looks like this:</p>
<div class="codehilite"><pre><span class="p">{</span>
    &quot;<span class="n">provides</span>&quot;<span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            &quot;<span class="n">ep</span>&quot;<span class="p">:</span> &quot;<span class="n">syntax</span><span class="p">.</span><span class="n">simple</span><span class="p">.</span><span class="n">highlighter</span>&quot;<span class="p">,</span>
            &quot;<span class="n">name</span>&quot;<span class="p">:</span> &quot;<span class="n">JavaScript</span>&quot;<span class="p">,</span>
            &quot;<span class="n">extensions</span>&quot;<span class="p">:</span> <span class="p">[</span>&quot;<span class="n">js</span>&quot;<span class="p">,</span> &quot;<span class="n">json</span>&quot;<span class="p">,</span> &quot;<span class="n">javascript</span>&quot;<span class="p">,</span> &quot;<span class="n">ecmascript</span>&quot;<span class="p">,</span> &quot;<span class="n">jsm</span>&quot;<span class="p">,</span> &quot;<span class="n">java</span>&quot;<span class="p">],</span>
            &quot;<span class="n">pointer</span>&quot;<span class="p">:</span> &quot;#<span class="n">JavaScript</span>&quot;
        <span class="p">}</span>
    <span class="p">],</span>
    &quot;<span class="n">depends</span>&quot;<span class="p">:</span> <span class="p">[</span>&quot;<span class="n">SimpleSyntax</span>&quot;<span class="p">]</span>
<span class="p">}</span>
</pre></div>


<p>The metadata is an object specified in JSON format. <code>provides</code> is a list of extensions that are provided by this plugin. Each one of the extensions is given as an object with one attribute that is always there: "ep". <code>ep</code> is the extension point that the extension is for. In the example above, you can see that the plugin is providing an extension for the "syntax.simple.highlighter" extension point. The other metadata for the extension is specific to the extension point.</p>
<p><code>pointer</code> is a common piece of metadata. Since this is pure JSON, and we want to lazily load the code anyhow, a pointer is a string that tells Bespin where to find the object that the extended code is going to need to perform the necessary work (in this case, the JavaScript syntax highlighting). A pointer is given in this format: <code>plugin:path/to/module/in/plugin#memberInModule</code>. The example above is about as simple as it gets. It's pointing to an object called <code>JavaScript</code> in the "package module" of the plugin (see more about the package module below). The <code>name</code> and <code>extensions</code> metadata are specific to the <code>syntax.simple.highlighter</code> extension point.</p>
<p>The <code>depends</code> list in the metadata is a list of the names of plugins upon which this plugin depends. Bespin will ensure that those plugins are loaded before this one. In the example above, the JavaScript highlighter plugin depends on the SimpleSyntax engine, which is itself a plugin.</p>
<h2>Plugin File Structure</h2>
<p>A plugin can be a single .js file with it's metadata bordered by specially formatted comments. Here's an example:</p>
<div class="codehilite"><pre><span class="o">//</span> <span class="o">---</span><span class="n">plugin</span><span class="p">.</span><span class="n">json</span><span class="o">---</span>
<span class="n">var</span> <span class="n">metadata</span> <span class="p">=</span> <span class="p">{};</span>
<span class="o">//</span> <span class="o">---</span>
</pre></div>


<p>You must start the metadata with <code>// ---plugin.json---</code> and end it with "// ---". To be legitimate JavaScript, you need to assign the metadata to a variable, but it can be any variable. The assignment and trailing semicolons are automatically stripped off.</p>
<p>Often, a single file is not going to be enough. When you move beyond a single file, a plugin is defined as a directory with a <code>plugin.json</code> file in it. In a single file plugin, the "package module" is the plugin .js file. In a plugin directory, the "package module" is a file called "package.js".</p>
</div>
<!-- / MAIN COLUMN -->

<!-- SIDEBAR -->
<div id="sidebar">


<h2 class="compact">Contents</h2>
<ul class="compact">
<li><a href="index.html">Introduction</a></li>
<li><a href="extpoints.html">Built-in Extension Points</a></li>
<li><a href="distributing.html">Distributing Plugins</a></li>
</ul>







</div>
<!-- / SIDEBAR -->

<!-- / MAIN CONTAINER -->
</div>

<!-- FOOTER -->
<div id="footer">
	<!-- COLUMN ONE -->
	<div>
	<h2 class="compact">Useful Links</h2>
	<ul class="compact">
		<li><a href="http://labs.mozilla.com/bespin/">Bespin project home page</a></li>
		<li><a href="https://wiki.mozilla.org/Labs/Bespin">Wiki</a></li>
		<li><a href="https://wiki.mozilla.org/Labs/Bespin/UserGuide">User's Guide</a></li>
	</ul>
	</div>
	<!-- / COLUMN ONE -->

	<!-- COLUMN TWO -->
	<div>
	<h2 class="compact">Developer Resources</h2>
	<ul class="compact">
	  <li><a href="http://hg.mozilla.org/labs/bespinclient/">Main Code Repository</a></li>
	  <li><a href="http://hg.mozilla.org/labs/bespinserver/">Python server repository</a></li>
		<li><a href="http://groups.google.com/group/bespin-core/">bespin-core mailing list for developers</a></li>
		<li><a href="http://groups.google.com/group/bespin-commits/">bespin-commits mailing list for repository commit messages</a></li>
		<li><a href="https://bugzilla.mozilla.org/buglist.cgi?product=bespin">Bug List</a></li>
	</ul>
	</div>
	<!-- / COLUMN TWO -->

	<!-- COLUMN THREE -->
	<div>
	<h2 class="compact">Get Help</h2>
	<ul class="compact">
		<li>The <a href="http://groups.google.com/group/bespin/">Bespin mailing list</a></li>
		<li>Via IRC: <a href="irc://irc.mozilla.org/bespin">#bespin on irc.mozilla.org</a></li>
	</ul>

	<h2 class="compact">Documentation Template</h2>
	<ul class="compact">
		<li>Adapted from a design by <a href="http://www.mgrabovsky.is-game.com/">Matěj Grabovský</a></li>
	</ul>
	</div>
	<!-- / COLUMN THREE -->
</div>
<!-- / FOOTER -->

</body>
</html>